# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WireGuard VPN –Ω–∞ MikroTik: WinBox –∏ –¢–µ—Ä–º–∏–Ω–∞–ª

---

> ‚ö†Ô∏è **WireGuard –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ MikroTik RouterOS –≤–µ—Ä—Å–∏–∏ 7 –∏ –≤—ã—à–µ!**  
> –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ MikroTik RouterOS 7.19.3.
>  
> **–í–ù–ò–ú–ê–ù–ò–ï! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ –∫–ª—é—á–∏, –∞–¥—Ä–µ—Å–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–≤–æ–∏ —Å–µ—Ç–∏ –∏–∑ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ù–µ –∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ ‚Äî –∑–∞–º–µ–Ω–∏—Ç–µ –∏—Ö –Ω–∞ —Å–≤–æ–∏!**

---

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WireGuard VPN –Ω–∞ MikroTik: WinBox –∏ –¢–µ—Ä–º–∏–Ω–∞–ª](#-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-wireguard-vpn-–Ω–∞-mikrotik-winbox-–∏-—Ç–µ—Ä–º–∏–Ω–∞–ª)
  - [üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ](#-–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)
  - [üìù –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è?](#-—á—Ç–æ-–¥–µ–ª–∞–µ—Ç-—ç—Ç–∞-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
  - [üí° –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ WireGuard](#-–ø—Ä–∏–º–µ—Ä-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏-–∫–ª–∏–µ–Ω—Ç–∞-wireguard)
  - [üõ†Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ](#Ô∏è-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∫-–Ω–∞—Å—Ç—Ä–æ–π–∫–µ)
  - [üß© –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#-–ø–æ—à–∞–≥–æ–≤–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
    - [1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ WireGuard](#1Ô∏è‚É£-—Å–æ–∑–¥–∞–Ω–∏–µ-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞-wireguard)
    - [2Ô∏è‚É£ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É](#2Ô∏è‚É£-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-ip-–∞–¥—Ä–µ—Å–∞-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É)
    - [3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É (peer)](#3Ô∏è‚É£-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è-–∫-—Å–µ—Ä–≤–µ—Ä—É-peer)
    - [4Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT (–º–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥)](#4Ô∏è‚É£-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-nat-–º–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥)
    - [5Ô∏è‚É£ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS-–∑–∞–ø—Ä–æ—Å–æ–≤](#5Ô∏è‚É£-–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-dns-–∑–∞–ø—Ä–æ—Å–æ–≤)
    - [6Ô∏è‚É£ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ DNS, NAT –ò –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤](#6Ô∏è‚É£-—Å–∫—Ä–∏–ø—Ç-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏-dns-nat-–∏-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–º–∞—Ä—à—Ä—É—Ç–æ–≤)
    - [7Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DHCP-–∫–ª–∏–µ–Ω—Ç–∞](#7Ô∏è‚É£-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dhcp-–∫–ª–∏–µ–Ω—Ç–∞)
    - [8Ô∏è‚É£ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ FastTrack](#8Ô∏è‚É£-–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ-fasttrack)
    - [9Ô∏è‚É£ –í–∞–∂–Ω–æ –ø—Ä–æ MTU –∏ TCPMSS](#9Ô∏è‚É£-–≤–∞–∂–Ω–æ-–ø—Ä–æ-mtu-–∏-tcpmss)
      - [üêß –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ WireGuard (Linux):](#-–Ω–∞-—Å–µ—Ä–≤–µ—Ä–µ-wireguard-linux)
      - [üõ°Ô∏è –ù–∞ MikroTik:](#Ô∏è-–Ω–∞-mikrotik)
  - [‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–¥—Å–µ—Ç–µ–π](#-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–Ω–æ–≤—ã—Ö-–ø–æ–¥—Å–µ—Ç–µ–π)
  - [‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã](#-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã)
  - [‚ùì FAQ](#-faq)
  - [üõ†Ô∏è Troubleshooting](#Ô∏è-troubleshooting)
    - [1. –ü—Ä–æ–±–ª–µ–º—ã —Å MTU](#1-–ø—Ä–æ–±–ª–µ–º—ã-—Å-mtu)
    - [2. –ü—Ä–æ–±–ª–µ–º—ã —Å DNS](#2-–ø—Ä–æ–±–ª–µ–º—ã-—Å-dns)
    - [3. –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π](#3-–ø—Ä–æ–±–ª–µ–º—ã-—Å-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π)
    - [4. –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª—é—á–∞–º–∏](#4-–ø—Ä–æ–±–ª–µ–º—ã-—Å-–∫–ª—é—á–∞–º–∏)
    - [5. FastTrack –Ω–µ –æ—Ç–∫–ª—é—á—ë–Ω](#5-fasttrack-–Ω–µ-–æ—Ç–∫–ª—é—á—ë–Ω)
    - [6. –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º WireGuard](#6-–Ω–µ—Ç-—Å–≤—è–∑–∏-—Å-—Å–µ—Ä–≤–µ—Ä–æ–º-wireguard)
  - [üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏](#-–ø–æ–ª–µ–∑–Ω—ã–µ-—Å—Å—ã–ª–∫–∏)

---

## üìù –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è?
- üõ°Ô∏è –°–æ–∑–¥–∞—ë—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å WireGuard –¥–ª—è VPN
- üè∑Ô∏è –ù–∞–∑–Ω–∞—á–∞–µ—Ç IP-–∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
- üîó –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç peer (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É)
- üó∫Ô∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –∏ NAT –¥–ª—è VPN-—Ç—Ä–∞—Ñ–∏–∫–∞
- üåê –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç DNS-–∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ VPN
- ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è VPN –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS
- üö´ –û—Ç–∫–ª—é—á–∞–µ—Ç FastTrack –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## üí° –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ WireGuard

> **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ –∫–ª—é—á–∏, –∞–¥—Ä–µ—Å–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–≤–æ–∏ —Å–µ—Ç–∏ –∏–∑ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!**

–ù–∏–∂–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ WireGuard. –ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á, –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á, –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ç.–¥.).

```ini
[Interface]
PrivateKey = –ü–†–ò–í–ê–¢–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê
Address = 172.29.8.7/32
DNS = 172.29.8.1

[Peer]
PublicKey = –ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê
PresharedKey = PRESHARED_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê
Endpoint = vpn.example.com:51443
AllowedIPs = 172.29.8.0/24, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. 
PersistentKeepalive = 15
```

---

## üõ†Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

> **–í–ù–ò–ú–ê–ù–ò–ï! –í—Å–µ –∫–ª—é—á–∏, –∞–¥—Ä–µ—Å–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–µ—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∑—è—Ç—ã –∏–∑ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø—Ä–∏–º–µ—Ä–∞!**

1. **–î–ª—è WinBox** üñ•Ô∏è:
   - –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WinBox —Å —Å–∞–π—Ç–∞ MikroTik.
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Ä–æ—É—Ç–µ—Ä—É, –≤–≤–µ–¥—è IP-–∞–¥—Ä–µ—Å, –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.

![–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–æ—É—Ç–µ—Ä—É —á–µ—Ä–µ–∑ WinBox](https://github.com/user-attachments/assets/ad9a128f-c9d8-43e9-b03c-b8bf076c6df3)
2. **–î–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞** üíª:
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Ä–æ—É—Ç–µ—Ä—É —á–µ—Ä–µ–∑ SSH –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ WinBox (–∫–Ω–æ–ø–∫–∞ **New Terminal**).
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏** üîë: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å `–ü–†–ò–í–ê–¢–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê`, `–ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê`, `PRESHARED_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê` –∏ –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (`vpn.example.com:51443`).

---

## üß© –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ WireGuard

> **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏ –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–∑ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!**

**–ß–µ—Ä–µ–∑ WinBox**:
1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **Interfaces**.
2. –ù–∞–∂–º–∏—Ç–µ **+** –∏ –≤—ã–±–µ—Ä–∏—Ç–µ **WireGuard**.
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
   - **Name**: –í–≤–µ–¥–∏—Ç–µ `wg-vpn`.
   - **MTU**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `1420`.
   - **Private Key**: –í—Å—Ç–∞–≤—å—Ç–µ `–ü–†–ò–í–ê–¢–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê`.
4. –ù–∞–∂–º–∏—Ç–µ **OK**.

![–°–∫—Ä–∏–Ω—à–æ—Ç: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ WireGuard –≤ WinBox](https://github.com/user-attachments/assets/fd4c254e-8e45-4036-b99e-8e57509d0219)

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª**:
```mikrotik
/interface wireguard add name=wg-vpn mtu=1420 private-key="–ü–†–ò–í–ê–¢–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê"
```

- **name**: –ò–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (`wg-vpn`).
- **mtu**: –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ (1420 ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è WireGuard).
- **private-key**: –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Ä–æ—É—Ç–µ—Ä–∞.

---

### 2Ô∏è‚É£ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

> **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π IP-–∞–¥—Ä–µ—Å –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–∑ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!**

**–ß–µ—Ä–µ–∑ WinBox**:
1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **IP** ‚Üí **Addresses**.
2. –ù–∞–∂–º–∏—Ç–µ **+** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞.
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
   - **Address**: –í–≤–µ–¥–∏—Ç–µ `172.29.8.7/24`.
   - **Interface**: –í—ã–±–µ—Ä–∏—Ç–µ `wg-vpn`.
4. –ù–∞–∂–º–∏—Ç–µ **OK**.

![–°–∫—Ä–∏–Ω—à–æ—Ç: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –¥–ª—è wg-vpn](https://github.com/user-attachments/assets/8e748ec5-2fb4-4f79-a365-af32c63f4631)

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª**:
```mikrotik
/ip address add address=172.29.8.7/24 interface=wg-vpn
```

- **address**: IP-–∞–¥—Ä–µ—Å –¥–ª—è VPN.
- **interface**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`wg-vpn`).

---

### 3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É (peer)

> **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ –∫–ª—é—á–∏, endpoint, allowed-address –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Å–≤–æ–∏ —Å–µ—Ç–∏!**

**–ß–µ—Ä–µ–∑ WinBox**:
1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **Interfaces** ‚Üí **WireGuard** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Peers**.
2. –ù–∞–∂–º–∏—Ç–µ **+** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ peer.
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
  - **Interface**: –í—ã–±–µ—Ä–∏—Ç–µ `wg-vpn`.
  - **Public Key**: –í—Å—Ç–∞–≤—å—Ç–µ `–ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê`.
  - **Preshared Key**: –í—Å—Ç–∞–≤—å—Ç–µ `PRESHARED_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê`.
  - **Endpoint**: –í–≤–µ–¥–∏—Ç–µ `vpn.example.com`.
  - **Endpoint Port**: –í–≤–µ–¥–∏—Ç–µ `51443`.
  - **Allowed IPs**: –í—Å—Ç–∞–≤—å—Ç–µ: `0.0.0.0/0`
  - **Persistent Keepalive**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `30`.
4. –ù–∞–∂–º–∏—Ç–µ **OK**.
   
![–°–∫—Ä–∏–Ω—à–æ—Ç: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WireGuard Peer –≤ WinBox](https://github.com/user-attachments/assets/cf852080-e7ee-4d59-86e7-75067ec71f0e)

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª**:
```mikrotik
/interface wireguard peers add \
   interface=wg-vpn \
   public-key="–ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê" \
   preshared-key="PRESHARED_–ö–õ–Æ–ß_–°–ï–†–í–ï–†–ê" \
   endpoint-address=vpn.example.com \
   endpoint-port=51443 \
   allowed-address=0.0.0.0/0 \
   persistent-keepalive=30s
```

- **interface**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å WireGuard.
- **public-key**: –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞.
- **preshared-key**: –û–±—â–∏–π —Å–µ–∫—Ä–µ—Ç.
- **endpoint-address/port**: –ê–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞.
- **allowed-address**: –°–µ—Ç—å 0.0.0.0/0 —É–∫–∞–∂–∏–º —á–µ—Ä–µ–∑ —Ñ–∞–π–ª ips.txt –¥–∞–ª–µ–µ. 
- **persistent-keepalive**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (30 —Å–µ–∫—É–Ω–¥).


### 4Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT (–º–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥)

> **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —Å–µ—Ç–∏!**

**–ß–µ—Ä–µ–∑ WinBox**:
1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **IP** ‚Üí **Firewall** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **NAT**.
2. –ù–∞–∂–º–∏—Ç–µ **+** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞.
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
   - **Chain**: –í—ã–±–µ—Ä–∏—Ç–µ `srcnat`.
   - **Out. Interface**: –í—ã–±–µ—Ä–∏—Ç–µ `wg-vpn`.
   - **Action**: –í—ã–±–µ—Ä–∏—Ç–µ `masquerade`.
   - **Comment**: –í–≤–µ–¥–∏—Ç–µ `Masquerade VPN`.
4. –ù–∞–∂–º–∏—Ç–µ **OK**.
   
![–°–∫—Ä–∏–Ω—à–æ—Ç: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT –≤ WinBox](https://github.com/user-attachments/assets/56e00be0-d63b-4612-aec0-a0fb5fb55f94)

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª**:
```mikrotik
/ip firewall nat add chain=srcnat action=masquerade out-interface=wg-vpn comment="Masquerade VPN"
```

- **chain**: –¶–µ–ø–æ—á–∫–∞ NAT (`srcnat`).
- **action**: –ü–æ–¥–º–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ (`masquerade`).
- **out-interface**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`wg-vpn`).

---

### 5Ô∏è‚É£ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS-–∑–∞–ø—Ä–æ—Å–æ–≤

> **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã!**

**–ß–µ—Ä–µ–∑ WinBox**:
1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **IP** ‚Üí **Firewall** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Mangle**.
2. –ù–∞–∂–º–∏—Ç–µ **+** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞.
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
   - **Chain**: –í—ã–±–µ—Ä–∏—Ç–µ `postrouting`.
   - **Src. Address**: –í–≤–µ–¥–∏—Ç–µ `192.168.88.0/24`.
   - **Out. Interface**: –í—ã–±–µ—Ä–∏—Ç–µ `wg-vpn`.
   - **Action**: –í—ã–±–µ—Ä–∏—Ç–µ `add src. to address list`.
   - **Address List**: –í–≤–µ–¥–∏—Ç–µ `RedirectDNS`.
   - **Address List Timeout**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `60s`.
4. –ù–∞–∂–º–∏—Ç–µ **OK**.

![–°–∫—Ä–∏–Ω—à–æ—Ç: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mangle –¥–ª—è DNS –≤ WinBox](https://github.com/user-attachments/assets/2c993b31-98ca-4bbe-8301-7eb4a94ead85)

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª**:
```mikrotik
/ip firewall mangle add chain=postrouting src-address=192.168.88.0/24 action=add-src-to-address-list address-list=RedirectDNS address-list-timeout=60s out-interface=wg-vpn

```

- **src-address**: –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å.
- **action**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ `RedirectDNS`.
- **out-interface**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`wg-vpn`).

---

### 6Ô∏è‚É£ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ DNS, NAT –ò –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤

> ‚ö†Ô∏è **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —à–∞–≥!**  
> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∑—è—Ç—å —Ñ–∞–π–ª `/root/antizapret/result/ips.txt` —Å —Å–µ—Ä–≤–µ—Ä–∞ AntiZapret –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ø–∞–ø–∫—É `files` –Ω–∞ MikroTik.  
> –í —Ç—Ä–µ—Ç—å–µ–π —Å—Ç—Ä–æ–∫–µ —Å–∫—Ä–∏–ø—Ç–∞ Up –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π —à–ª—é–∑ ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ AntiZapret –ø–æ–¥—Å–µ—Ç–∏ (`172.29.8.1` –∏–ª–∏ `10.29.8.1`).


**üßë‚Äçüíª –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Netwatch (WG-Monitor)**

**–ß–µ—Ä–µ–∑ WinBox**:

1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **Tools ‚Üí Netwatch**.
2. –ù–∞–∂–º–∏—Ç–µ **+** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
  - **üåê Host**: –í–≤–µ–¥–∏—Ç–µ `172.29.8.1` (IP-–∞–¥—Ä–µ—Å –∑–∞ WireGuard-—Ç—É–Ω–Ω–µ–ª–µ–º).
  - **‚è±Ô∏è Interval**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `00:00:15` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥).
  - **‚åõ Timeout**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `5.00` (–æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ 5 —Å–µ–∫—É–Ω–¥).
  - **‚úÖ Enabled**: –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.
  - **üü¢ Up Script**: –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥:
  
```mikrotik
/log info "[WG-Monitor] WireGuard is RUNNING ‚Äî applying rules"
:local routeFile "ips.txt"
:local routeGateway "172.29.8.1"
:local routeComment "wg-auto-route"
/ip dns cache flush
:if ([:len [/ip firewall nat find comment="Redirect to Router"]] > 0) do={
  /ip firewall nat remove [find comment="Redirect to Router"]
}
/ip firewall nat add action=redirect chain=dstnat src-address-list="RedirectDNS" dst-port=53 protocol=udp comment="Redirect to Router"
/ip dns set servers=$routeGateway
:local content [/file get $routeFile contents]
:if ([:len $content] > 0) do={
    :local line ""
    :for i from=0 to=([:len $content] - 1) do={
        :local char [:pick $content $i]
        :if ($char != "\r" && $char != "\n") do={
            :set line ($line . $char)
        } else={
            :if ([:len $line] > 5) do={
                :do { /ip route add dst-address=$line gateway=$routeGateway distance=1 comment=$routeComment } on-error={}
            }
            :set line ""
        }
    }
    :if ([:len $line] > 5) do={
         :do { /ip route add dst-address=$line gateway=$routeGateway distance=1 comment=$routeComment } on-error={}
    }
}
:local dotPos [:find $routeGateway "."]
:if ($dotPos != "") do={
    :local firstOctet [:pick $routeGateway 0 $dotPos]
    :local derivedDstAddress ($firstOctet . ".30.0.0/15")
    :do { /ip route add dst-address=$derivedDstAddress gateway=$routeGateway distance=1 comment=$routeComment } on-error={}
}

```
  - **üî¥ Down Script**: –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥:
```mikrotik
/log info "[WG-Monitor] WireGuard is NOT running ‚Äî reverting rules"
/ip firewall nat remove [find comment="Redirect to Router"]
/ip dns set servers=8.8.8.8
/ip dns cache flush
/ip route remove [find comment="wg-auto-route"]

```
1. –ù–∞–∂–º–∏—Ç–µ **OK**.

![–°–∫—Ä–∏–Ω—à–æ—Ç: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ WG-Monitor –≤ WinBox](https://github.com/user-attachments/assets/d598b9f6-e271-4580-83b2-48e97edad107)

---

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª**:

```mikrotik
/tool netwatch add host=172.29.8.1 interval=15s timeout=5s disabled=no \
up-script={:log info "[WG-Monitor] WireGuard is RUNNING ‚Äî applying rules"; \
:local routeFile "ips.txt"; \
:local routeGateway "172.29.8.1"; \
:local routeComment "wg-auto-route"; \
/ip dns cache flush; \
:if ([:len [/ip firewall nat find comment="Redirect to Router"]] > 0) do={ \
  /ip firewall nat remove [find comment="Redirect to Router"]; \
}; \
/ip firewall nat add action=redirect chain=dstnat src-address-list="RedirectDNS" dst-port=53 protocol=udp comment="Redirect to Router"; \
/ip dns set servers=\$routeGateway; \
:local content [/file get \$routeFile contents]; \
:if ([:len \$content] > 0) do={ \
    :local line ""; \
    :for i from=0 to=([:len \$content] - 1) do={ \
        :local char [:pick \$content \$i]; \
        :if (\$char != "\r" && \$char != "\n") do={ \
            :set line (\$line . \$char); \
        } else={ \
            :if ([:len \$line] > 5) do={ \
                :do { /ip route add dst-address=\$line gateway=\$routeGateway distance=1 comment=\$routeComment } on-error={}; \
            }; \
            :set line ""; \
        }; \
    }; \
    :if ([:len \$line] > 5) do={ \
         :do { /ip route add dst-address=\$line gateway=\$routeGateway distance=1 comment=\$routeComment } on-error={}; \
    }; \
}; \
:local dotPos [:find \$routeGateway "."]; \
:if (\$dotPos != "") do={ \
    :local firstOctet [:pick \$routeGateway 0 \$dotPos]; \
    :local derivedDstAddress (\$firstOctet . ".30.0.0/15"); \
    :do { /ip route add dst-address=\$derivedDstAddress gateway=\$routeGateway distance=1 comment=\$routeComment } on-error={}; \
}} \
down-script={:log info "[WG-Monitor] WireGuard is NOT running ‚Äî reverting rules"; \
/ip firewall nat remove [find comment="Redirect to Router"]; \
/ip dns set servers=8.8.8.8; \
/ip dns cache flush; \
/ip route remove [find comment="wg-auto-route"]}
```

---

**üîé –ß—Ç–æ –¥–µ–ª–∞–µ—Ç WG-Monitor:**
- üü¢ **WireGuard —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç DNS —á–µ—Ä–µ–∑ VPN, –æ—Ç–∫–ª—é—á–∞–µ—Ç DNS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç NAT.
- üî¥ **WireGuard –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –∏ NAT.

---
### 7Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DHCP-–∫–ª–∏–µ–Ω—Ç–∞

DHCP-–∫–ª–∏–µ–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ether1) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–æ—É—Ç–µ—Ä—É –ø–æ–ª—É—á–∞—Ç—å IP-–∞–¥—Ä–µ—Å –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

- **WinBox**:  
  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **IP ‚Üí DHCP Client ‚Üí Add (+)**.  
  –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, ether1), —É–±–µ—Ä–∏—Ç–µ –≥–∞–ª–æ—á–∫—É "Use Peer DNS", –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É "Add Default Route".
- **–¢–µ—Ä–º–∏–Ω–∞–ª**:
  ```bash
  /ip dhcp-client add interface=ether1 use-peer-dns=no add-default-route=yes
  ```

> - `use-peer-dns=no` ‚Äî –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ DNS –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
> - `add-default-route=yes` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

> **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ether1 –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ª—É—á–∞–µ—Ç IP-–∞–¥—Ä–µ—Å.**

---

**üí° –ü—Ä–∏–º–µ—Ä: DHCP Client Add**

![DHCP Client Add](https://github.com/Kirito0098/AntiZapret-OpenVPN-Mikrotik/raw/main/screenshot/WinBox_WfS4CCVDPU.png)
*IP ‚Üí DHCP Client ‚Üí Add*

---

### 8Ô∏è‚É£ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ FastTrack

**–ß–µ—Ä–µ–∑ WinBox**:
1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **IP** ‚Üí **Firewall** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Filter Rules**.
2. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ —Å `Action = fasttrack-connection`.
3. –í—ã–¥–µ–ª–∏—Ç–µ –µ–≥–æ –∏ –Ω–∞–∂–º–∏—Ç–µ **Disable** (–∏–∫–æ–Ω–∫–∞ —Å –∫—Ä–µ—Å—Ç–∏–∫–æ–º).

![–°–∫—Ä–∏–Ω—à–æ—Ç: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ FastTrack –≤ WinBox](https://github.com/user-attachments/assets/33e5b174-c298-48a1-b103-f35510d203b3)

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª**:
```mikrotik
/ip firewall filter disable [find action=fasttrack-connection]
```
---
### 9Ô∏è‚É£ –í–∞–∂–Ω–æ –ø—Ä–æ MTU –∏ TCPMSS

> üõë **–ï—Å–ª–∏ —Å–∞–π—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ–±—Ä—ã–≤–∞—é—Ç—Å—è –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç TLS 1.3 ‚Äî –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ ‚Äî –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π MTU –∏–ª–∏ MSS!**  
> ‚ö° **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ MSS –¥–ª—è WireGuard, –Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ ‚Äî —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ MikroTik!**

–î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã TCP —á–µ—Ä–µ–∑ WireGuard –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ MSS (Maximum Segment Size) ‚Äî **–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –Ω–∞ MikroTik** (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç).

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤–∏–ª–∞ TCPMSS:**
```bash
sudo iptables -t mangle -S | grep TCPMSS
```
> **‚ÑπÔ∏è –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –Ω–∏—á–µ–≥–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!**  
> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É –≤—ã—à–µ. –ï—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É.

#### üêß –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ WireGuard (Linux):

```bash
iptables -t mangle -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
```

> ‚ö†Ô∏è –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ: –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –æ–Ω–æ –∏—Å—á–µ–∑–Ω–µ—Ç.  
> –ß—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª–æ —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å, –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/etc/rc.local`) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ persistent iptables (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞–∫–µ—Ç `iptables-persistent`).
>  
> üîß –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç MSS –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–π MTU –º–∞—Ä—à—Ä—É—Ç–∞, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è "—Ç–∏—Ö–∏–µ" –ø–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤.

#### üõ°Ô∏è –ù–∞ MikroTik:

**–ß–µ—Ä–µ–∑ WinBox**:
1. üñ•Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é **IP** ‚Üí **Firewall** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Mangle**.
2. ‚ûï –ù–∞–∂–º–∏—Ç–µ **+** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞.
3. ‚öôÔ∏è –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
  - **Chain**: –≤—ã–±–µ—Ä–∏—Ç–µ `forward`.
  - **Protocol**: –≤—ã–±–µ—Ä–∏—Ç–µ `tcp`.
  - **TCP Flags**: –≤—ã–±–µ—Ä–∏—Ç–µ `syn`.
  - **Out. Interface**: –≤—ã–±–µ—Ä–∏—Ç–µ `wg-vpn`.
  - **Action**: –≤—ã–±–µ—Ä–∏—Ç–µ `change MSS`.
  - **New MSS**: –≤—ã–±–µ—Ä–∏—Ç–µ `clamp to pmtu`.
  - **Comment**: –≤–≤–µ–¥–∏—Ç–µ `Clamp MSS for WG`.
4. ‚úÖ –ù–∞–∂–º–∏—Ç–µ **OK**.

**–ß–µ—Ä–µ–∑ –¢–µ—Ä–º–∏–Ω–∞–ª:**
```mikrotik
/ip firewall mangle add chain=forward protocol=tcp tcp-flags=syn action=change-mss new-mss=clamp-to-pmtu out-interface=wg-vpn comment="Clamp MSS for WG"
```

## ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–¥—Å–µ—Ç–µ–π

> **–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø–æ–¥—Å–µ—Ç–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è!**

1. **–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–¥—Å–µ—Ç–µ–π:**

–î–æ–±–∞–≤–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–¥—Å–µ—Ç–µ–π —á–µ—Ä–µ–∑ VPN-—à–ª—é–∑.

```shell
/ip route add dst-address=–ù–û–í–ê–Ø_–ü–û–î–°–ï–¢–¨_1 gateway=172.29.8.1 distance=1
/ip route add dst-address=–ù–û–í–ê–Ø_–ü–û–î–°–ï–¢–¨_2 gateway=172.29.8.1 distance=1
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

- **–ü–∏–Ω–≥ VPN-—à–ª—é–∑–∞** üèì:
  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å VPN-—à–ª—é–∑–∞ —á–µ—Ä–µ–∑ WireGuard-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

  ```shell
  /ping 172.29.8.1 interface=wg-vpn
  ```

- **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞** üß≠:
  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç –¥–æ –≤–Ω–µ—à–Ω–µ–≥–æ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ VPN.

  ```shell
  /tool traceroute 104.16.0.1
  ```

- **–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ** üìä:
  –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–æ –ø–æ—Ä—Ç—É 443.

  ```shell
  /tool sniffer quick interface=wg-vpn port=443
  ```
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** üß™:
   ```shell
   /interface wireguard peers print
   ```
- **–õ–æ–≥–∏** üìã:
   ```shell
   /log print
   ```

---

## ‚ùì FAQ

**Q: –ö–∞–∫ —É–∑–Ω–∞—Ç—å, —á—Ç–æ WireGuard —Ä–∞–±–æ—Ç–∞–µ—Ç?**  
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ peer'–∞ —á–µ—Ä–µ–∑ `/interface wireguard peers print`.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–æ–¥—Å–µ—Ç—å?**  
A: –î–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ allowed-address peer'–∞ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç.

**Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ DNS –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ VPN?**  
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ NAT —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º "Redirect to Router".

---

## üõ†Ô∏è Troubleshooting

### 1. –ü—Ä–æ–±–ª–µ–º—ã —Å MTU

- **–°–∏–º–ø—Ç–æ–º—ã:** —Å–∞–π—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, –æ–±—Ä—ã–≤—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
- **–†–µ—à–µ–Ω–∏–µ:** —É–º–µ–Ω—å—à–∏—Ç–µ MTU –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ WireGuard –¥–æ 1380 –∏–ª–∏ –Ω–∏–∂–µ:
  ```shell
  /interface wireguard set [find name=wg-vpn] mtu=1380
  ```

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å DNS

- **–°–∏–º–ø—Ç–æ–º—ã:** —Å–∞–π—Ç—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è, –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É —á–µ—Ä–µ–∑ VPN.
- **–†–µ—à–µ–Ω–∏–µ:**
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö DNS —É–∫–∞–∑–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 172.29.8.1).
  - –û—á–∏—Å—Ç–∏—Ç–µ DNS-–∫—ç—à:
    ```shell
    /ip dns cache flush
    ```
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è DNS —Ä–∞–±–æ—Ç–∞–µ—Ç:
    ```shell
    /ip firewall nat print where comment="Redirect to Router"
    ```

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π

- **–°–∏–º–ø—Ç–æ–º—ã:** –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω—É–∂–Ω—ã–º –ø–æ–¥—Å–µ—Ç—è–º, VPN-—Ç—Ä–∞—Ñ–∏–∫ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç.
- **–†–µ—à–µ–Ω–∏–µ:**
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã:
    ```shell
    /ip route print
    ```
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —à–ª—é–∑ (gateway) –¥–æ—Å—Ç—É–ø–µ–Ω:
    ```shell
    /ping 172.29.8.1 interface=wg-vpn
    ```
  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥—Å–µ—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –≤ allowed-address peer'–∞.

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª—é—á–∞–º–∏

- **–°–∏–º–ø—Ç–æ–º—ã:** VPN –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, peer –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö.
- **–†–µ—à–µ–Ω–∏–µ:**
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–µ–π.
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ preshared-key —Å–æ–≤–ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö.

### 5. FastTrack –Ω–µ –æ—Ç–∫–ª—é—á—ë–Ω

- **–°–∏–º–ø—Ç–æ–º—ã:** VPN —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ, —Ç—Ä–∞—Ñ–∏–∫ –Ω–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è.
- **–†–µ—à–µ–Ω–∏–µ:** –æ—Ç–∫–ª—é—á–∏—Ç–µ FastTrack:
  ```shell
  /ip firewall filter disable [find action=fasttrack-connection]
  ```

### 6. –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º WireGuard

- **–°–∏–º–ø—Ç–æ–º—ã:** peer –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –Ω–µ—Ç handshake.
- **–†–µ—à–µ–Ω–∏–µ:**
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å endpoint-address –∏ port.
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä WireGuard –¥–æ—Å—Ç—É–ø–µ–Ω —Å —Ä–æ—É—Ç–µ—Ä–∞ (ping, traceroute).
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ firewall –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UDP-–ø–æ—Ä—Ç WireGuard (51443).

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è Wiki MikroTik (WireGuard)](https://help.mikrotik.com/docs/display/ROS/WireGuard)
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è WireGuard](https://www.wireguard.com/)
- [MikroTik RouterOS Wiki](https://wiki.mikrotik.com/wiki/Main_Page)
- [WireGuard Quick Start](https://www.wireguard.com/quickstart/)



